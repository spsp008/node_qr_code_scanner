<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css">

    <title>QR SCANNER</title>
  </head>
  <body style="background-color: #888;">
    <div style=" background-color: #FFF; border: 2px dashed #888; width: 80%; top:50%; left: 50%; transform: translate3d(-50%,-50%, 0); position: absolute; padding: 20px">
      <h3>QR Scanner</h3>
      <form id="form" enctype="multipart/form-data">
        <fieldset class="form-group">
          <div class="row">
            <legend class="col-form-label col-sm-2 pt-0">Choose image source type</legend>
            <div class="col-sm-10">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios1" value="option1" checked>
                <label class="form-check-label" for="gridRadios1">
                  Upload image
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios2" value="option2">
                <label class="form-check-label" for="gridRadios2">
                  Enter Url
                </label>
              </div>
            </div>
          </div>
        </fieldset>
        <div class="form-group row">
          <label class="col-sm-2 col-form-label" for="media">Select image</label>
          <div class="col-sm-10" >
            <input type="file" class="form-control-file" style="width: 40%;" name="media" id="media" placeholder=".png, .jpeg">
          </div>
        </div>
        <div class="form-group row">
          <label class="col-sm-2 col-form-label" for="url">Enter image url</label>
          <div class="col-sm-10">
            <input type="input" class="form-control" style="width: 80%;" name="media_url" id="url" placeholder="https://image.png">
          </div>
        </div>
        <div class="form-group">
          <label for="outputTextArea">Output</label>
          <textarea style="font-family: Lucida Console, Courier New, monospace;" placeholder="output text" class="form-control" id="outputTextArea" rows="3"></textarea>
        </div>
        <button type="button" onclick="submitForm()" class="btn btn-primary">Scan</button>
      </form>
    </div>

  </body>
  <script>
    function submitForm() {
      var inputFile = document.querySelector('input[type="file"]');
      var url = document.querySelector('input[type="input"]');
      var data = new FormData();
      data.append('media', inputFile.files[0]);
      data.append('media_url', url.value);
      const {origin} = document.location;
      fetch(`${origin}/decode`, {
        body: data,
        method: "POST"
      })
      .then(res => res.json())
      .then(response => {
        let textarea = document.querySelector('textarea');
        if (response.success) {
          textarea.value = response.text;
          textarea.style.border = '1px solid #4fec54';
        } else {
          textarea.value = response.message;
          textarea.style.border = '1px solid red';
        }
      })
      .catch(err => {
        console.error(err);
      });
    }
  </script>
</html>
